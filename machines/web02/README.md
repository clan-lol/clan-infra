# Kanidm

## Creating new users

1. Enter the `clan-infra` dev shell

   ```bash
   $ cd ~/clan-infra
   $ direnv allow
   ```

2. Log in as the IDM admin:

   ```bash
   $ clan vars get web02 kanidm/idm-admin-password
   123
   $ kanidm login --name idm_admin
   Enter password: [hidden]
   ```

3. Create a new user:

   Please pick a username and display name (can contain spaces) for the new
   user:

   ```bash
   $ kanidm person create <username> <display name>
   # Outline requires accounts to have an email address, they don't need to work :)
   $ kanidm person update <username> --mail example@example.com
   ```

   As Kanidm uses UUIDs as the primary key, the username, display name and email
   addresses can be changed later.

4. Create a reset passkey/password link for the user:

   Send the following link generated by running the following command to the
   user and tell them to add a passkey to their account:

   ```bash
   $ kanidm person credential create-reset-token <username>
   The person can use one of the following to allow the credential reset

   Scan this QR Code:
   ...
   This link: https://idm.thecomputer.co/ui/reset?token=xxx
   ```
